{{> header}}
<div class='new-trips'>
    <div class='new-trips-content'>
    </div>
</div> 
<script type="text/javascript">
    function setItemsToDrop(){var e=!1,t=this.getValue().toUpperCase();if($(".itemsToDropGroup select option").each(function(i,o){o.text.toUpperCase()===t&&(e=!0)}),!e){var i="";$(".materialNameGroup input").each(function(){$(this).val()&&(i+='<option value="'+$(this).val().toUpperCase()+'">'+$(this).val().toUpperCase()+"</option>")}),$(".itemsToDropGroup select").each(function(){var e=$(this).val();$(this).html(i),$(this).multiselect("rebuild"),e&&e.length>0&&$(this).multiselect("select",e),$(this).val()&&0!==$(this).val().length||$(this).multiselect("select",[t])})}}function initializeItemsToDropInEditMode(e){if(e.data&&e.data.pickup&&e.data.pickup.length>0){var t=[];if(e.data.pickup.forEach(function(e){e.material&&e.material.length>0&&e.material.forEach(function(e){e.name&&t.indexOf(e.name)<0&&t.push(e.name.toUpperCase())})}),t.length>0){var i="";t.forEach(function(e){i+='<option value="'+e+'">'+e+"</option>"}),$(".itemsToDropGroup select").each(function(t,o){$(o).val();$(o).html(i),$(o).multiselect("rebuild"),e.data.drop&&e.data.drop.length>t&&e.data.drop[t].itemsToDrop&&$(o).multiselect("select",e.data.drop[t].itemsToDrop)})}}}console.log("template data",UTILS.getCurrentTemplateData()),$(document).ready(function(){var e=UTILS.getCurrentTemplateData();FORM_HELPER.draw(".new-trips-content",e,{bindings:{pickup:"column-1",drop:"column-2",vehicleRequirements:"column-2",comments:"column-2",totalWeight:"column-2",totalWeightUnit:"column-2",id:"column-2"},schemaOverride:{fields:{pickup:{title:"Pickup point(s)"},drop:{title:"Drop point(s)",items:{properties:{itemsToDrop:{required:!0,type:"string",items:null}}}}}},optionsOverride:{focus:"pickup[0]/date",fields:{pickup:{order:1,helper:"You can add multiple pickup points",items:{fields:{material:{items:{fields:{name:{fieldClass:"materialNameGroup",events:{blur:function(){setItemsToDrop.apply(this,[])}}}}}}}}},drop:{order:2,helper:"You can add multiple drop points",items:{fields:{itemsToDrop:{type:"select",multiple:!0,fieldClass:"itemsToDropGroup"}}}},vehicleRequirements:{order:3},comments:{order:4,items:{type:"textarea"}},totalWeight:{order:5},totalWeightUnit:{order:6}}},callbacks:{preRender:function(e){},beforeSubmit:function(){},afterSubmit:function(){MENU_HELPER.menuClick("manageTrip","manageTrip")},onSubmitError:function(){},postRender:function(){initializeItemsToDropInEditMode(e)}},postUrl:"trips/service/addTrip"})});
</script>