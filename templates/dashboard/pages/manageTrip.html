{{{{raw-helper}}}}
{{{{/raw-helper}}}}
<div class="row">
        <div class="col-lg-12">
                <ol class="breadcrumb" style="margin-top: 10px;">
                    <li class="active">
                            <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fa {{pageIcon}}"></i> 
                             {{#if extraOptions.data}}
                             <BtnCaption>{{extraOptions.data.status}}</BtnCaption>  
                             {{else}}
                             <BtnCaption>{{pageSubHeading}}</BtnCaption>  
                             {{/if}}
                        </button>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item" href="javascript:statusChanged('New');">New Trips</a>
                            <a class="dropdown-item" href="javascript:statusChanged('Quoted');">Quoted</a>
                            <a class="dropdown-item" href="javascript:statusChanged('PaymentPending');">Payment Pending</a>
                            <a class="dropdown-item" href="javascript:statusChanged('PaymentMade');">Payment Made</a>
                             {{#ifEquals (getLoggedInRole) "CALL_CENTER_USER"}}
                            <!-- <a class="dropdown-item" href="javascript:statusChanged('Paymentreceived');">Payment Received</a> -->
                            <a class="dropdown-item" href="javascript:statusChanged('PaymentApproved');">Payment Approved</a>
                            {{/ifEquals}} 
                            <a class="dropdown-item" href="javascript:statusChanged('Running');">Running</a>
                            <a class="dropdown-item" href="javascript:statusChanged('Assigned');">Assigned</a>
                            <a class="dropdown-item" href="javascript:statusChanged('Successful');">Successful</a>
                            <a class="dropdown-item" href="javascript:statusChanged('Cancelled');">Cancelled</a>                
                        </div>
                        </div>
                    </li>
                </ol>
        </div>
    </div>
<div class='manage-trips'>
     <div class='manage-trips-content'>            
    </div>
</div> 
{{{{raw-helper}}}}
<script id="grid-row-template-details" type="text/x-handlebars-template">
  <div class="container-fluid">
    <div class="row grid-row">
        <div class="col-sm-4 grid-row-container">
            <div class="grid-row-title">Pickup point:</div>                      
                {{#with pickup}}
                    {{{exceptOnFirst @index '<hr/>'}}}
                    <div class="row">     
                        <div class="grid-row-tile col-sm-12">                
                            <div>
                                <span class="grid-row-tile-label">Date & time</span>
                                <span class="grid-row-tile-text">{{date}}</span>
                            </div>
                            <div>
                                <span class="grid-row-tile-label">Address</span>
                                <span class="grid-row-tile-text">
                                    {{#if address.organisation}} {{address.organisation}}, {{/if}}
                                    {{#if address.city}} {{address.city}}, {{/if}}
                                    {{#if address.location}}
                                    {{address.location}}, {{/if}} {{#if address.zip}}{{address.zip}}.{{/if}}
                                </span>                    
                            </div>                            
                        </div>  
                    </div>
                    {{#if contact}}
                    <div class="row"> 
                         <div class="grid-row-tile col-sm-12">
                            <span class="grid-row-tile-label">Contact(s)</span>
                            <div>        
                                {{#each contact}} 
                                    <div>                                        
                                         <span class="grid-row-tile-text">
                                            {{#if firstName}} {{firstName}} {{lastName}} - {{/if}} {{mobile}} {{#if email}} - {{email}} {{/if}} 
                                        </span>                   
                                    </div>                                                                             
                                {{/each}}
                            </div>
                        </div> 
                    </div> 
                    {{/if}}
                    <div class="row"> 
                         <div class="grid-row-tile col-sm-12">
                            <span class="grid-row-tile-label">Material(s)</span>
                            <div>        
                                {{#with material}} 
                                    <div>                                        
                                         <span class="grid-row-tile-text">
                                            {{name}} 
                                            {{#if weight}} ({{weight}} {{weightUnit}}) {{/if}}
                                            {{#if materialType}} - {{materialType}} {{/if}}
                                            {{#if approximateCost}} - valued at {{currency approximateCost}} {{/if}}
                                        </span>                   
                                    </div>                                                                             
                                {{/with}}
                            </div>
                        </div> 
                    </div>                    
                {{/with}}                                   
        </div>   
        <div class="col-sm-4 grid-row-container">
            <div class="grid-row-title">Drop point:</div>                      
                {{#with drop}}
                    <div class="row">     
                        <div class="grid-row-tile col-sm-12">                
                            {{#if date}}
                            <div>
                                <span class="grid-row-tile-label">Date & time</span>
                                <span class="grid-row-tile-text">{{date}}</span>
                            </div>
                            {{/if}}
                            <div>
                                <span class="grid-row-tile-label">Address</span>
                                <span class="grid-row-tile-text">
                                    {{#if address.organisation}} {{address.organisation}}, {{/if}}
                                    {{#if address.city}} {{address.city}}, {{/if}}
                                    {{#if address.location}}
                                    {{address.location}}, {{/if}} {{#if address.zip}}{{address.zip}}.{{/if}}
                                </span>                    
                            </div>                            
                        </div>  
                    </div>
                    {{#if contact}}
                    <div class="row"> 
                         <div class="grid-row-tile col-sm-12">
                            <span class="grid-row-tile-label">Contact(s)</span>
                            <div>        
                                {{#each contact}} 
                                    <div>                                        
                                         <span class="grid-row-tile-text">
                                            {{#if firstName}} {{firstName}} {{lastName}} - {{/if}} {{mobile}} {{#if email}} - {{email}} {{/if}} 
                                        </span>                   
                                    </div>                                                                             
                                {{/each}}
                            </div>
                        </div> 
                    </div> 
                    {{/if}}
                    {{#if itemsToDrop}}
                    <div class="row"> 
                         <div class="grid-row-tile col-sm-12">
                            <div>        
                                <span class="grid-row-tile-label">Items to drop</span>
                                <span class="grid-row-tile-text">
                                    {{#if itemsToDrop}}
                                    {{commaSeperatedArray itemsToDrop}}                                    
                                    {{/if}}
                                </span>
                            </div>
                        </div> 
                    </div>           
                    {{/if}}                          
                {{/with}}                                   
        </div>  
        <div class="col-sm-4 grid-row-container">
            <div class="grid-row-title">Vehicle Requirements:</div> 
            <div class="row">     
                <div class="grid-row-tile col-sm-12">                
                    <div>
                        <span class="grid-row-tile-text">
                            {{#with vehicleRequirements}}
                                <div>
                                    {{vehicleType}}
                                    {{#if requiredCapacity}}
                                         with capacity {{requiredCapacity}} {{capacityUnit}} 
                                    {{/if}}
                                    {{#if minRating}} with rating {{minRating}} {{/if}}
                                </div>
                            {{/with}}
                        </span>
                    </div>                                           
                </div>  
            </div>
            {{#if totalWeight}}
            <div class="grid-row-title">Total Weight:</div> 
             <div class="row">     
                <div class="grid-row-tile col-sm-12">                
                    <div>
                        <span class="grid-row-tile-text">  
                            {{totalWeight}} {{totalWeightUnit}}
                        </span>
                    </div>                                           
                </div>  
            </div>
            {{/if}}
            {{#if truckdetails}}            
            <div class="grid-row-title">Truckdetails:</div>  
            <div class="row">     
                <div class="grid-row-tile col-sm-12">                
                    <div>
                        <span class="grid-row-tile-text">
                           {{plateNumber}} {{truckType}}
                        </span>
                    </div>                                           
                </div>  
            </div>
        {{/if}} 
            {{#if currentPoint}}            
            <div class="grid-row-title">Current location:</div>  
            <div class="row">     
                <div class="grid-row-tile col-sm-12">                
                    <div>
                        <span class="grid-row-tile-text">
                        {{currentPoint}}
                        </span>
                    </div>                                           
                </div>  
            </div>
        {{/if}} 
            {{#if quotes}}
                <div class="grid-row-title">Quote:</div> 
                <div class="row">     
                    <div class="grid-row-tile col-sm-12">                
                        <div>
                            <span class="grid-row-tile-text">
                                {{quotes.cost}} 
                            </span>
                        </div>                                           
                    </div>  
                </div>
            {{/if}}
            <div class="grid-row-title">Status:</div> 
             <div class="row">     
                <div class="grid-row-tile col-sm-12">                
                    <div>
                        <span class="grid-row-tile-text">
                            {{status}} 
                        </span>
                    </div>                                           
                </div>  
            </div>
        </div>     
    </div>
  </div>
</script>
<script id="grid-row-options-template" type="text/x-handlebars-template">
  <div class="container-fluid">
    <div class="row grid-row">       
        <div class="col-sm-12">
            <div class="pull-right">
                {{#each (getGridOptions status _id)}}     
                <button type="button" class="btn btn-default btn-primary {{id}}" _id="{{_id}}">{{option}}</button>
                {{/each}}
            </div>
        </div>       
    </div>
  </div>
</script>
<script id="viewquotesmodal" type="text/x-handlebars-template"> 
    <div class="modal fade" id="viewquotesmodalid" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
             <div class="modal-dialog">
                 <div class="modal-content">
                   <div class="modal-header">
                       <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                           &times;
                       </button>
                       <h4 class="modal-title" id="myModalLabel">Are you sure?</h4>
                   </div>
                   <div class="modal-body myModalclass">
                        If approved, payment is mandatory and once payment is received suitable truck & driver will be assigned to your trip.
                   </div>
                   <div class="modal-footer">
                        <button type="submit" id="yes" class="btn btn-primary" name="submit" value="submit">
                          Yes
                      </button> 
                       <button name="cancel" value="cancel" class="btn btn-default" data-dismiss="modal">
                           Cancel
                       </button>
                   </div>
                   </div>
                   </div> 
        </div>
    </script> 
{{{{/raw-helper}}}}
{{{{raw-helper}}}}
<script type="text/javascript">
    console.log("template data",UTILS.getCurrentTemplateData()),$(document).ready(function(){var i=UTILS.getCurrentTemplateData();new GRID_HELPER.GRID(".manage-trips-content",{gridData:i,gridId:"gridManageTrips",rowConfig:{template:"grid-row-template-details",optionsTemplate:"grid-row-options-template",optionsEvent:"mouseover",optionsPostRender:function(i,e){$(i).find(".edit-trip").click(function(){MENU_HELPER.menuClick("addTripMin","manageTrip",{extraHref:e._id})}),$(i).find(".comments-trip").click(function(){MENU_HELPER.menuClick("addComments","manageTrip",{extraHref:e._id})}),$(i).find(".docs-trip").click(function(){MENU_HELPER.menuClick("uploadDocs","manageTrip",{extraHref:e._id})}),$(i).find(".viewdetails").click(function(){MENU_HELPER.menuClick("viewTripDetails","manageTrip",{extraHref:e._id})}),$(i).find(".payment").click(function(){MENU_HELPER.menuClick("tripPayment","manageTrip",{extraHref:e._id})}),$(i).find(".cancel-trip").click(function(){MENU_HELPER.menuClick("cancelTrip","manageTrip",{extraHref:e._id})}),$(i).find(".approve-quote").click(function(){approveQuote(e)}),$(i).find(".quote-trip").click(function(){MENU_HELPER.menuClick("setTripQuote","manageTrip",{extraHref:e._id})}),$(i).find(".status-trip").click(function(){MENU_HELPER.menuClick("setTripStatus","manageTrip",{extraHref:e._id})}),$(i).find(".setlocation").click(function(){MENU_HELPER.menuClick("setLocation","manageTrip",{extraHref:e._id})}),$(i).find(".assigntruck").click(function(){MENU_HELPER.menuClick("assignTruck","manageTrip",{extraHref:e._id})}),$(i).find(".approvepayment").click(function(){var i={};i.formData=JSON.stringify({tripDetails:e}),i.uri="trips/service/setStatus",i.extraHref="id="+e._id+"&status=PaymentApproved",i.type="POST",API_HELPER.postData(i,function(i,e){if(i)return void console.log("error",i)}),MENU_HELPER.menuClick("manageTrip","manageTrip")}),$(i).find(".reject-bid").click(function(){var i={};i.formData=JSON.stringify({truckDetails:e}),i.uri="requests/service/setStatus",i.extraHref="id="+e._id+"&status=Rejected",i.type="POST",API_HELPER.postData(i,function(i,e){if(i)return void console.log("error",i)}),MENU_HELPER.menuClick("manageTrip","manageTrip",{extraHref:e._id})})}},sortConfig:{multiple:!1,options:[{title:"Pickup Date",key:"pickup.date",selected:!0,order:"desc"},{title:"Drop Date",key:"drop.date"},{title:"Material Value",key:"pickup.material.approximateCost"}]},filterConfig:{type:"default",order:[],formOptions:{bindings:{"pickup.date_start":"column-1","pickup.date_end":"column-2","drop.date_start":"column-1","drop.date_end":"column-2",status:"column-1"},schemaOverride:{fields:{"pickup.date":{title:"Pickup Date",format:"date",rangeField:!0},"drop.date":{title:"Drop Date",format:"date",rangeField:!0},status:{"default":"Running"}}},optionsOverride:{fields:{"pickup.date_start":{order:1},"pickup.date_end":{order:2},"drop.date_start":{order:3},"drop.date_end":{order:4},status:{order:5}}}}}});statusChanged=function(i){var e={data:{status:i}};MENU_HELPER.menuClick("manageTrip","manageTrip",e)},approveQuote=function(i){var e=$("#viewquotesmodal").html(),t=Handlebars.compile(e);$("body").append(t()),$("#viewquotesmodalid").modal({show:!0,background:!0}),$("#yes").click(function(){var e={};e.formData=JSON.stringify({tripDetails:i}),e.uri="trips/service/setStatus",e.extraHref="id="+i._id+"&status=PaymentPending",e.type="POST",API_HELPER.postData(e,function(e,t){return e?void console.log("error",e):void MENU_HELPER.menuClick("paymentPending","manageTrip",{extraHref:i._id})}),$("#viewquotesmodalid").modal("hide")})}}),Handlebars.registerHelper("getGridOptions",function(i,e){var t=[],o=API_HELPER.getLoggedInUser();switch(i){case"New":t=[{option:"Edit",_id:e,id:"edit-trip"},{option:"Comments",_id:e,id:"comments-trip"},{option:"Docs",_id:e,id:"docs-trip"},{option:"Cancel Trip",_id:e,id:"cancel-trip"}],"CALL_CENTER_USER"===o.role&&t.push({option:"Quote",_id:e,id:"quote-trip"});break;case"Quoted":t=[{option:"Edit",_id:e,id:"edit-trip"},{option:"Comments",_id:e,id:"comments-trip"},{option:"Approve Quote",_id:e,id:"approve-quote"},{option:"Reject Quote",_id:e,id:"reject-quote"},{option:"Cancel Trip",_id:e,id:"cancel-trip"}];break;case"PaymentPending":t=[{option:"Docs",_id:e,id:"docs-trip"},{option:"Comments",_id:e,id:"comments-trip"},{option:"Details",_id:e,id:"viewdetails"},{option:"Payment",_id:e,id:"payment"}];break;case"PaymentMade":t=[{option:"Docs",_id:e,id:"docs-trip"},{option:"Comments",_id:e,id:"comments-trip"},{option:"Details",_id:e,id:"viewdetails"}],"CALL_CENTER_USER"===o.role&&t.push({option:"Approve",_id:e,id:"approvepayment"});break;case"PaymentApproved":t=[{option:"Docs",_id:e,id:"docs-trip"},{option:"Comments",_id:e,id:"comments-trip"},{option:"Details",_id:e,id:"viewdetails"}],"CALL_CENTER_USER"===o.role&&t.push({option:"Assign Truck",_id:e,id:"assigntruck"});break;case"Running":t=[{option:"Details",_id:e,id:"viewdetails"},{option:"Comments",_id:e,id:"comments-trip"},{option:"Docs",_id:e,id:"docs-trip"}],"CALL_CENTER_USER"===o.role&&t.push({option:"Location",_id:e,id:"setlocation"});break;case"Assigned":case"Successful":t=[{option:"Details",_id:e,id:"viewdetails"},{option:"Comments",_id:e,id:"comments-trip"},{option:"Docs",_id:e,id:"docs-trip"}],"CALL_CENTER_USER"===o.role&&t.push({option:"Status",_id:e,id:"status-trip"});break;case"Cancelled":t=[{option:"Details",_id:e,id:"viewdetails"}]}return t});
</script>
{{{{/raw-helper}}}}